================================================================================
                    AI-RSS-Hub 测试环境搭建指南
================================================================================

目录：
1. requirements.txt 检查
2. 创建虚拟环境和安装依赖
3. 创建 .env 配置文件
4. .env 文件配置说明
5. 启动应用
6. 验证运行
7. 常用测试命令
8. 停止应用
9. 关键提示

================================================================================

## 1. requirements.txt 检查

您的 requirements.txt 已经非常完整了，包含了所有必要的依赖：

✅ FastAPI + Uvicorn (Web 框架)
✅ SQLModel + SQLAlchemy (数据库 ORM)
✅ feedparser (RSS 解析)
✅ openai (LLM API 客户端)
✅ APScheduler (定时任务)
✅ pydantic-settings (配置管理)
✅ python-dotenv (环境变量)
✅ httpx (HTTP 客户端)
✅ pytest (测试工具)

【结论】无需补充，依赖已经完整！

================================================================================

## 2. 创建虚拟环境和安装依赖

在终端中执行以下命令：

```bash
# 进入项目目录
cd /home/sam/Github/get_news_api/AI-RSS-Hub

# 创建虚拟环境（如果还没有创建）
python3 -m venv venv

# 激活虚拟环境
source venv/bin/activate

# 升级 pip 到最新版本
pip install --upgrade pip

# 安装所有依赖
pip install -r requirements.txt

# 如果网络慢，可以使用清华镜像源：
# pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

【提示】激活成功后，终端提示符前会显示 (venv)

================================================================================

## 3. 创建 .env 配置文件

项目已经有 .env.example 模板了，执行以下命令创建您的配置文件：

```bash
# 复制模板文件
cp .env.example .env

# 使用编辑器打开（选择您喜欢的编辑器）
nano .env
# 或者： vim .env
# 或者： code .env
```

================================================================================

## 4. .env 文件配置说明

根据 app/config.py 中的配置，您需要设置以下环境变量：

--------------------------------------------------------------------------------
【必填配置】
--------------------------------------------------------------------------------

# LLM API Key（必填 - 用于生成文章摘要）
OPENAI_API_KEY=sk-your-api-key-here

--------------------------------------------------------------------------------
【可选配置】（如果不填会使用默认值）
--------------------------------------------------------------------------------

# 数据库路径（默认：sqlite:///./ai_rss_hub.db）
DATABASE_URL=sqlite:///./ai_rss_hub.db

# LLM API 基础 URL（默认：https://api.openai.com/v1）
# 如果使用 DeepSeek，改为：https://api.deepseek.com
OPENAI_API_BASE=https://api.openai.com/v1

# LLM 模型名称（默认：gpt-3.5-turbo）
# 如果使用 DeepSeek，改为：deepseek-chat
OPENAI_MODEL=gpt-3.5-turbo

# RSS 抓取间隔（小时，默认：1）
FETCH_INTERVAL_HOURS=1

# HTTP 请求超时时间（秒，默认：30）
REQUEST_TIMEOUT=30

# 摘要最大长度（默认：100）
SUMMARY_MAX_LENGTH=100

# LLM API 超时时间（秒，默认：30）
LLM_TIMEOUT=30

--------------------------------------------------------------------------------
【使用 DeepSeek 的示例配置】
--------------------------------------------------------------------------------

OPENAI_API_KEY=sk-your-deepseek-key-here
OPENAI_API_BASE=https://api.deepseek.com
OPENAI_MODEL=deepseek-chat

================================================================================

## 5. 启动应用

```bash
# 确保虚拟环境已激活（提示符前有 (venv)）
# 如果没有激活，执行：source venv/bin/activate

# 启动方式 1：使用 uvicorn（推荐，支持热重载）
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# 启动方式 2：直接运行
python -m app.main

# 启动方式 3：使用启动脚本（如果有）
./run.sh
```

启动成功后，您会看到类似以下的输出：

INFO:     Started server process [12345]
INFO:     Waiting for application startup.
应用启动中...
数据库表创建成功
成功插入 3 个默认 RSS 源
调度器已启动，任务将每 1 小时执行一次
应用启动完成
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000

================================================================================

## 6. 验证运行

启动成功后，访问以下 URL：

🏠 主页：http://localhost:8000/
📖 API 文档：http://localhost:8000/docs
💚 健康检查：http://localhost:8000/api/health
📊 系统状态：http://localhost:8000/api/status

【推荐】在浏览器中打开 http://localhost:8000/docs
        可以看到交互式 API 文档并测试所有接口。

================================================================================

## 7. 常用测试命令

# 获取所有 RSS 源
curl http://localhost:8000/api/feeds

# 获取文章列表
curl http://localhost:8000/api/articles?limit=10

# 添加新的 RSS 源
curl -X POST http://localhost:8000/api/feeds \
  -H "Content-Type: application/json" \
  -d '{
    "name": "GitHub Blog",
    "url": "https://github.blog/feed/",
    "category": "tech",
    "is_active": true
  }'

# 获取特定 Feed 的文章
curl http://localhost:8000/api/feeds/1/articles

# 手动触发一次 RSS 抓取
curl -X POST http://localhost:8000/api/feeds/fetch

================================================================================

## 8. 停止应用

在终端按 Ctrl + C 停止服务。

停用虚拟环境：
```bash
deactivate
```

如需清理环境：
```bash
# 删除虚拟环境（如需重建）
rm -rf venv

# 删除数据库（清空数据）
rm ai_rss_hub.db
```

================================================================================

## 9. 关键提示

1. API Key 是必须的
   应用启动后需要调用 LLM API 生成文章摘要，所以必须配置 OPENAI_API_KEY

2. 数据库位置
   默认数据库文件会创建在 AI-RSS-Hub/ai_rss_hub.db

3. 定时任务
   应用启动后会自动开始定时抓取 RSS（默认每小时一次）

4. 日志查看
   终端会显示详细的运行日志，包括 RSS 抓取和 AI 总结的状态

5. 开发模式
   使用 --reload 参数可以在代码修改后自动重启服务

6. API 文档
   访问 /docs 可以查看和测试所有 API 接口

================================================================================

## 常见问题 FAQ

Q1: 虚拟环境激活失败？
A: Windows PowerShell 需要执行：
   Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser

Q2: 依赖安装失败？
A: 尝试使用国内镜像：
   pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

Q3: LLM API 调用失败？
A: 检查 .env 配置：
   - 确保 API Key 正确
   - 确保 API Base URL 正确
   - 检查网络连接

Q4: 数据库文件在哪里？
A: 默认位置：AI-RSS-Hub/ai_rss_hub.db
   查看数据库内容：sqlite3 ai_rss_hub.db

Q5: 如何手动触发一次 RSS 抓取？
A: 调用 API：curl -X POST http://localhost:8000/api/feeds/fetch
   或重启应用（启动时会执行一次）

================================================================================

配置文件参数说明：

config.py 中定义的所有配置项：

类型          | 配置项                | 默认值                          | 说明
-------------|----------------------|--------------------------------|------------------
数据库       | DATABASE_URL          | sqlite:///./ai_rss_hub.db      | 数据库连接字符串
LLM API      | OPENAI_API_KEY        | None                           | API 密钥（必填）
LLM API      | OPENAI_API_BASE       | https://api.openai.com/v1      | API 基础 URL
LLM API      | OPENAI_MODEL          | gpt-3.5-turbo                  | 使用的模型
RSS 抓取     | FETCH_INTERVAL_HOURS  | 1                              | 抓取间隔（小时）
RSS 抓取     | REQUEST_TIMEOUT       | 30                             | 请求超时（秒）
AI 总结      | SUMMARY_MAX_LENGTH    | 100                            | 摘要最大长度
AI 总结      | LLM_TIMEOUT           | 30                             | LLM 超时（秒）

================================================================================

快速开始命令汇总：

# 一键完成环境搭建（复制粘贴到终端）
cd /home/sam/Github/get_news_api/AI-RSS-Hub
python3 -m venv venv
source venv/bin/activate
pip install --upgrade pip
pip install -r requirements.txt
cp .env.example .env
# 然后编辑 .env 文件填入你的 API Key
nano .env
# 最后启动应用
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

================================================================================

祝您使用愉快！如有问题请查看日志或联系开发者。

生成时间：2025-12-25
文档版本：v1.0

================================================================================
